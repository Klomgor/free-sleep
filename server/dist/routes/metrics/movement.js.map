{"version":3,"file":"movement.js","sources":["routes/metrics/movement.ts"],"sourceRoot":"/","sourcesContent":["import express, { Request, Response } from 'express';\nimport { Prisma } from '@prisma/client';\nimport moment from 'moment-timezone';\nimport { loadMovementRecords } from '../../db/loadMovementRecords.js';\nimport { prisma } from '../../db/prisma.js';\n\nconst router = express.Router();\n\n// Define query params\ninterface MovementQuery {\n  side?: string;\n  startTime?: string;\n  endTime?: string;\n}\n\nrouter.get('/movement', async (req: Request<object, object, object, MovementQuery>, res: Response) => {\n  const { startTime, endTime, side } = req.query;\n  const query: Prisma.movementWhereInput = {\n    timestamp: {},\n  };\n\n  if (side) query.side = side;\n  if (startTime) {\n    // @ts-expect-error\n    query.timestamp.gte = moment(startTime).unix();\n  }\n  if (endTime) {\n    // @ts-expect-error\n    query.timestamp.lte = moment(endTime).unix();\n  }\n\n  const movementRecords = await prisma.movement.findMany({\n    where: query,\n    orderBy: { timestamp: 'asc' },\n  });\n\n  const formattedRecords = await loadMovementRecords(movementRecords);\n  res.json(formattedRecords);\n});\n\n\n\nexport default router;\n"],"names":[],"mappings":";;AAAA,OAAO,OAA8B,MAAM,SAAS,CAAC;AAErD,OAAO,MAAM,MAAM,iBAAiB,CAAC;AACrC,OAAO,EAAE,mBAAmB,EAAE,MAAM,iCAAiC,CAAC;AACtE,OAAO,EAAE,MAAM,EAAE,MAAM,oBAAoB,CAAC;AAE5C,MAAM,MAAM,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC;AAShC,MAAM,CAAC,GAAG,CAAC,WAAW,EAAE,KAAK,EAAE,GAAmD,EAAE,GAAa,EAAE,EAAE;IACnG,MAAM,EAAE,SAAS,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC;IAC/C,MAAM,KAAK,GAA8B;QACvC,SAAS,EAAE,EAAE;KACd,CAAC;IAEF,IAAI,IAAI;QAAE,KAAK,CAAC,IAAI,GAAG,IAAI,CAAC;IAC5B,IAAI,SAAS,EAAE,CAAC;QACd,mBAAmB;QACnB,KAAK,CAAC,SAAS,CAAC,GAAG,GAAG,MAAM,CAAC,SAAS,CAAC,CAAC,IAAI,EAAE,CAAC;IACjD,CAAC;IACD,IAAI,OAAO,EAAE,CAAC;QACZ,mBAAmB;QACnB,KAAK,CAAC,SAAS,CAAC,GAAG,GAAG,MAAM,CAAC,OAAO,CAAC,CAAC,IAAI,EAAE,CAAC;IAC/C,CAAC;IAED,MAAM,eAAe,GAAG,MAAM,MAAM,CAAC,QAAQ,CAAC,QAAQ,CAAC;QACrD,KAAK,EAAE,KAAK;QACZ,OAAO,EAAE,EAAE,SAAS,EAAE,KAAK,EAAE;KAC9B,CAAC,CAAC;IAEH,MAAM,gBAAgB,GAAG,MAAM,mBAAmB,CAAC,eAAe,CAAC,CAAC;IACpE,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;AAC7B,CAAC,CAAC,CAAC;AAIH,eAAe,MAAM,CAAC","debug_id":"af6cb0e0-5b87-5049-815a-3964911c3d71"}