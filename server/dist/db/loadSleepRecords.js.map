{"version":3,"file":"loadSleepRecords.js","sources":["db/loadSleepRecords.ts"],"sourceRoot":"/","sourcesContent":["// Helper file to load raw sleep records from SQLite and convert the epoch timestamps -> ISO8601\nimport { sleep_records as PrismaSleepRecord } from '.prisma/client';\nimport settingsDB from './settings.js';\nimport moment from 'moment-timezone';\n\nimport { SleepRecord } from './prismaDbTypes.js';\n\nexport const loadSleepRecords = async (sleepRecords: PrismaSleepRecord[]): Promise<SleepRecord[]> => {\n  await settingsDB.read();\n  const userTimeZone: string = settingsDB.data.timeZone || 'UTC';\n\n  // Parse JSON fields\n  return sleepRecords.map((record: any) => ({\n    ...record,\n    entered_bed_at: moment.tz(record.entered_bed_at * 1000, userTimeZone).format(),\n    left_bed_at: moment.tz(record.left_bed_at * 1000, userTimeZone).format(),\n    present_intervals: record.present_intervals\n      ? JSON.parse(record.present_intervals).map(([start, end]: number[]) => [\n        moment.tz(start * 1000, userTimeZone).format(),\n        moment.tz(end * 1000, userTimeZone).format(),\n      ])\n      : [],\n    not_present_intervals: record.not_present_intervals\n      ? JSON.parse(record.not_present_intervals).map(([start, end]: number[]) => [\n        moment.tz(start * 1000, userTimeZone).format(),\n        moment.tz(end * 1000, userTimeZone).format(),\n      ])\n      : [],\n  })) as SleepRecord[];\n};\n"],"names":[],"mappings":";;AAEA,OAAO,UAAU,MAAM,eAAe,CAAC;AACvC,OAAO,MAAM,MAAM,iBAAiB,CAAC;AAIrC,MAAM,CAAC,MAAM,gBAAgB,GAAG,KAAK,EAAE,YAAiC,EAA0B,EAAE;IAClG,MAAM,UAAU,CAAC,IAAI,EAAE,CAAC;IACxB,MAAM,YAAY,GAAW,UAAU,CAAC,IAAI,CAAC,QAAQ,IAAI,KAAK,CAAC;IAE/D,oBAAoB;IACpB,OAAO,YAAY,CAAC,GAAG,CAAC,CAAC,MAAW,EAAE,EAAE,CAAC,CAAC;QACxC,GAAG,MAAM;QACT,cAAc,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,cAAc,GAAG,IAAI,EAAE,YAAY,CAAC,CAAC,MAAM,EAAE;QAC9E,WAAW,EAAE,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,WAAW,GAAG,IAAI,EAAE,YAAY,CAAC,CAAC,MAAM,EAAE;QACxE,iBAAiB,EAAE,MAAM,CAAC,iBAAiB;YACzC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,iBAAiB,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,EAAE,GAAG,CAAW,EAAE,EAAE,CAAC;gBACrE,MAAM,CAAC,EAAE,CAAC,KAAK,GAAG,IAAI,EAAE,YAAY,CAAC,CAAC,MAAM,EAAE;gBAC9C,MAAM,CAAC,EAAE,CAAC,GAAG,GAAG,IAAI,EAAE,YAAY,CAAC,CAAC,MAAM,EAAE;aAC7C,CAAC;YACF,CAAC,CAAC,EAAE;QACN,qBAAqB,EAAE,MAAM,CAAC,qBAAqB;YACjD,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,qBAAqB,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,EAAE,GAAG,CAAW,EAAE,EAAE,CAAC;gBACzE,MAAM,CAAC,EAAE,CAAC,KAAK,GAAG,IAAI,EAAE,YAAY,CAAC,CAAC,MAAM,EAAE;gBAC9C,MAAM,CAAC,EAAE,CAAC,GAAG,GAAG,IAAI,EAAE,YAAY,CAAC,CAAC,MAAM,EAAE;aAC7C,CAAC;YACF,CAAC,CAAC,EAAE;KACP,CAAC,CAAkB,CAAC;AACvB,CAAC,CAAC","debug_id":"50668e4f-a7f9-5c92-afdb-9a858e92d8b4"}